function ImageInGame(){this.assets=[];this.images=[];this.nbImagesLoaded=0;this.imagesLoaded=false;this.callback=function(){};this.add=function(){if(arguments.length===1)this.assets.push(arguments[0]);else if(arguments.length>1)for(var e=0,t=arguments.length;e<t;e++)this.assets.push(arguments[e])};this.get=function(e){return this.images[e]};this.loadAll=function(e){if("function"===typeof e)this.callback=e;var t=this;for(var n=0,r=this.assets.length;n<r;n++){var i=this.assets[n],s,o,u,a,f,l;s="object"===typeof i?i.filename:i;o=parseInt(i.sx)>0?i.sx:0;u=parseInt(i.sy)>0?i.sy:0;a=parseInt(i.sWidth)>0?i.sWidth:0;f=parseInt(i.sHeight)>0?i.sHeight:0;l=i.animDirection&&(i.animDirection==="right2left"||i.animDirection==="top2bottom"||i.animDirection==="bottom2top")?i.animDirection:"left2right";alternate=i.alternate||false;animByFrame=parseInt(i.animByFrame)>0?i.animByFrame:10;var c=new Image;c.src=s;c.onload=function(){t.loaded(this)};var h=/^(.*)\.(png|gif|jpg)$/ig.exec(s)[1];c.setAttribute("data-label",h);this.images[h]={data:c,width:0,height:0,sx:o,sy:u,sWidth:a,sHeight:f,animDirection:l,alternate:alternate,direction:l==="right2left"||l==="bottom2top"?-1:1,animByFrame:animByFrame,frameCount:0}}};this.loaded=function(e){var t=e.getAttribute("data-label");this.images[t].width=e.width;this.images[t].height=e.height;if(this.images[t].sWidth===0)this.images[t].sWidth=e.width;if(this.images[t].sHeight===0)this.images[t].sHeight=e.height;if(++this.nbImagesLoaded===this.countProperties(this.images)){this.imagesLoaded=true;this.callback()}};this.update=function(){for(var e in this.images){if(this.images.hasOwnProperty(e)){var t=this.images[e];if(t.animDirection!==null){++t.frameCount;if(t.frameCount>=t.animByFrame){t.frameCount=0;if(t.animDirection==="left2right"||t.animDirection==="right2left"){t.sx+=t.sWidth*t.direction;if(t.alternate){if(t.sx<=0||t.sx+t.sWidth>=t.width)t.direction*=-1}else{if(t.animDirection==="left2right"){if(t.sx>=t.width)t.sx=0}else if(t.animDirection==="right2left"){if(t.sx<0)t.sx=t.width-t.sWidth}}}if(t.animDirection==="top2bottom"||t.animDirection==="bottom2top"){t.sy+=t.sHeight*t.direction;if(t.alternate){if(t.sy<=0||t.sy+t.sHeight>=t.height)t.direction*=-1}else{if(t.animDirection==="top2bottom"){if(t.sy>=t.height)t.sy=0}else if(t.animDirection==="bottom2top"){if(t.sy<0)t.sy=t.height-t.sHeight}}}}}}}};this.drawImage=function(e,t,n,r){if("object"!==typeof e)throw new Error("ImageInGame.drawImage() : argument sent doesn't seems to be a valid 2d context.");return e.drawImage(t.data,t.sx,t.sy,t.sWidth,t.sHeight,n,r,t.sWidth,t.sHeight)};this.countProperties=function(e){var t=0,n;for(n in e){if(e.hasOwnProperty(n))t++}return t}}